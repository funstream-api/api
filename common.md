Общий API
==========
1. [**Пользователь**](#Пользователь)
  - [`POST` `P` `/api/user` Найти пользователя](#Найти-пользователя)
  - [`POST` `P` `/api/user/current` Данные текущего пользователя](#Данные-текущего-пользователя)
  - [`POST` `P` `/api/user/login` Логин](#Логин)
  - [`POST` `P` `/api/user/logout` Логаут](#Логаут)
  - [`POST` `C` `/api/user/register` Регистрация](#Регистрация)
  - [`POST` `A` `/api/user/settings` Получить или установить настройки текущего пользователя](#Получить-или-установить-настройки-текущего-пользователя)
2. [**Категория**](#Категория)
  - [`POST` `P` `/api/category` Категория контента](#Категория-контента)
3. [**Стрим**](#Стрим)
  - [`POST` `P` `/api/stream` Данные стрима](#Данные-стрима)
4. [**Чат**](#Чат)
  - [`POST` `P` `/api/channel/data` Данные каналов](#Данные-каналов)
  - [`POST` `P` `/api/smile` Доступные смайлы канала](#Доступные-смайлы-канала)
5. [**Фильтр**](#Фильтр)
  - [`POST` `A/P` `/api/content` Список элементов контента](#Список-элементов-контента)
  - [`POST` `P` `/api/content/top` Топ N элементов контента](#Топ-n-элементов-контента)
6. [**Подписки**](#Подписки)
  - [`POST` `A` `/api/subscribe/add` Подписаться](#Подписаться)
  - [`POST` `A` `/api/subscribe/amount` Количество активных подписок](#Количество-активных-подписок)
  - [`POST` `A` `/api/subscribe/check` Проверить подписку](#Проверить-подписку)
  - [`POST` `A` `/api/subscribe/list` Список подписок](#Список-подписок)
  - [`POST` `A` `/api/subscribe/remove` Отписаться](#Отписаться)
  - [`POST` `A` `/api/subscribe/subscribers` Список подписчиков пользователя](#Список-подписчиков-пользователя)
7. [**Игноры**](#Игноры)
  - [`POST` `A` `/api/ignore/add` Добавить в список игнорируемых](#Добавить-в-список-игнорируемых)
  - [`POST` `A` `/api/ignore/check` Проверить на игнор](#Проверить-на-игнор)
  - [`POST` `A` `/api/ignore/list` Список игнорируемого](#Список-игнорируемого)
  - [`POST` `A` `/api/ignore/remove` Удалить из списка игнорируемого](#Удалить-из-списка-игнорируемого)
8. [**Дополнительные вызовы**](#Дополнительные-вызовы)
  - [`POST` `P` `/api/bulk` Пакетный запрос](#Пакетный-запрос)
  - [`POST` `P` `/api/support?name=<streamer_name>` Получить список последних поддержавших для данного стримера за 5 минут](#Получить-список-последних-поддержавших-для-данного-стримера-за-5-минут)
    

## Пользователь

#### Найти пользователя
##### [`POST` `P` `/api/user`](http://funstream.tv/api/user)
**запрос**
```js
{
    id: <int|null>, // Идентификатор пользователя
    name: <string|null> // Имя пользователя
}
```
**ответ**
```js
{
    id: <int>, // Идентификатор пользователя
    name: <string> // Имя пользователя
}
```
*Может быть передан любой из параметров запроса.*  
*Вернёт ошибку если пользователь с таким идентификатором или именем не найден.*


#### Данные текущего пользователя
##### [`POST` `P` `/api/user/current`](http://funstream.tv/api/user/current)
**запрос**
```js
[]
```
**ответ**, *если токена авторизации нет или он неверный*
```js
{
    guest: true,
    settings: <obj>, // Настройки пользователя по умолчанию, объект из ответа /api/user/settings
    roles: <obj> // Роли пользователя, значения по умолчанию, см. ниже
}
```
**ответ**, *если токен авторизации верен*
```js
{
    guest: false,
    id: <int>, // Идентификатор пользователя
    name: <string>, // Имя пользователя
    settings: <obj>, // Настройки пользователя, объект из ответа /api/user/settings
    roles: <obj> { // Роли пользователя
        support: <bool>, // Сапорт, false по умолчанию
        canUseSupport: <bool>, // Возможность задавать вопрос саппортам и присоединяться к чат каналам вопросов, true по умолчанию
        moderator: <bool>, // Модератор, false по умолчанию
        citizen: <int> // Сила голоса гражданской модерации, 1 по умолчанию
    }
}
```


#### Логин
##### [`POST` `P` `/api/user/login`](http://funstream.tv/api/user/login)
**запрос**
```js
{
    name: <string>, // Имя пользлователя
    password: <string> // Пароль пользователя
}
```
**ответ**
```js
{
    token: <string>, // Строка с токеном
    current: <obj> // Данные пользователя, объект из ответа /api/user/current
}
```
*При успешном логине высталяется http-only кука, необходимая для прелоада funstream.tv.*  
*Вернёт ошибку если пользователь с таким именем и паролем не найден.*


#### Логаут
##### [`POST` `P` `/api/user/logout`](http://funstream.tv/api/user/logout)
**запрос**
```js
[]
```
**ответ**
```js
[]
```
*Уничтожает куку, установленную при логине.*


#### Регистрация
##### [`POST` `C` `/api/user/register`](http://funstream.tv/api/user/register)
**запрос**
```js
{
    name: <string>, // Имя пользователя
    password: <string>, // Пароль пользователя
    email: <string|null>, // Почта пользователя
    recaptchaResponse: <string> // Строка ответа Рекапчи
}
```
**ответ**
```js
{
    token: <string>, // строка с токеном
    current: <obj> // Данные пользователя, объект из ответа /api/user/current
}
```
*Работает только на funstream.tv из-за использования Рекапчи.*  
*При успешной регистрации сразу логинит пользователя.*  
*Вернёт ошибку если пользователь с таким именем уже существует, либо если не была пройдена капча.*


#### Получить или установить настройки текущего пользователя
##### [`POST` `A` `/api/user/settings`](http://funstream.tv/api/user/settings)
**запрос и ответ идентичны**
```js
{
    stream: <obj> {
        autostart: <bool>, // Автостарт плеера стрима, true по умолчанию,
        player: <string>, // Предпочитаемый плеер, по умолчанию пусто, приоретный плеер twitch.tv
        skipmain: <bool> // Пропускать главную страницу при прямом открытии ссылки funstream.tv, false по умолчанию
    },
    chat: <obj> {
        smiles: <bool>, // Показывать смайлы, true по умолчанию"
        images: <bool>, // Показывать миниатюру картинок в чате, false по умолчанию
        fontsize: <int>, // Размер шрифта чата, 12 по умолчанию
        namecolor: <int>, // Номер цвета ника, 0 по умолчанию
        mychannels: <array of strings>, // Список идентификаторов закрепленных каналов пользователя, пустой массив по умолчанию
        theme: <string>, // Тема формления чата, 'sc2tv' по умолчанию
        disablenamecolor: <bool>, // Отключить цветные ники, false по умолчанию
        thirdparty: <bool> // Показывать сообщения Твича и Гудгейма, true по умолчанию
    }
}
```
*В параметрах запроса могут отсутствовать любые поля или все сразу.
Все переданные в параметрах запроса настройки будут сохранены для текущего пользователя.*  
*Вернёт ошибку если токена авторизации нет, он неверен, или указаны ошибочные настройки.*


## Категория

#### Категория контента
##### [`POST` `P` `/api/category`](http://funstream.tv/api/category)
**запрос**
```js
{
    content: <string>, // Тип контента, [stream, support]
    id: <int|null>, // Идентификатор категории
    slug: <string|null>, // Короткое имя категории
    options: <object|null> {
        subCategories: <bool|null>, // Включая 1 уровень подкатегорий, false, по умолчанию 
        contentAmount: <bool|null> // Включая количество контента, false по умолчанию
    }
}
```
**ответ**
```js
{
    id: <int>, // Идентификатор категории
    slug: <string>, // Короткое имя категории
    name: <string>, // Полное имя категории
    subCategories: <array|null>, // Подкатегории, массив объектов с полями id, slug, name и contentAmount(если выставленна соответствующая опция)
    contentAmount: <int|null> // Количество контента
}
```
*Корневая категория для любого контента ищется по `slug: 'top'`.*  
*Вернёт ошибку если категория с таким id или slug не найдена.*


## Стрим

#### Данные стрима
##### [`POST` `P` `/api/stream`](http://funstream.tv/api/stream)
**запрос**
```js
{
    id: <int|null>, // Идентификатор стрима
    streamer: <string|null>, // Имя стримера
    options: <obj|null> {
        players: <bool|null> // Вернуть плееры стрима, false по умолчанию
    }
}
```
**ответ**
```js
{
    id: <int>, // Идентификатор стрима
    streamer: <obj>, // Данные стримера, объект из ответа /api/user
    name: <string>, // Заголовок стрима
    description: <string>, // Описание стрима
    category: <obj>, // Категория стрима, объект из ответа /api/category
    image: <string>, // Относительная ссылка на картинку заставки
    thumbnail: <string>, // Относительная ссылка на картинку превью
    adult: <bool>, // Флаг 18+
    start_at: <int>, // Временная метка начала стрима, 0 по умолчанию
    rating: <int>, // Текущий рейтинг стрима
    players: <array|null> [ // Активные(онлайн) плееры стрима
        {
            name: <string>, // Сервис плеера
            channel: <string>, // Имя канала плеера
            code: <string> // HTML код плеера с учётом настроек пользователя
        },
        ...
    ]
}
```
*Вернёт ошибку если стрима с данным id или именем стримера не существует.*


## Чат

#### Данные каналов
##### [`POST` `P` `/api/channel/data`](http://funstream.tv/api/channel/data)
**запрос**
```js
{
    channels: <array> [ // Список каналов
        <string>, // Идентификатор канала
        ...
    ]
}
```
**ответ**
```js
[
    {
        id: <string>, // Идентификатор канала
        name: <string>, // Имя канала
        user: <obj|null> // Владелец канала, объект из ответа /api/user
    },
    ...
]
```
*Вернёт ошибку если хотя бы один из переданных идентификаторов неверен.*


#### Доступные смайлы канала
##### [`POST` `P` `/api/smile`](http://funstream.tv/api/smile)
**запрос**
````js
{
    channel: <string> // Идентификатор канала
}
```
**ответ**
```js
[
    [
        {
            code: <string>, // Код смайла
            image: <string>, // Имя файла картинки смайла
            position: <int>, // Позиция смайла в табе
            usable: <bool>, // Флаг доступности смайла пользователю
            width: <int>, // Ширина картинки смайла в пикселях
            height: <int> // Высота картинки смайла в пикселях
        },
        ...
    ],
    ...
]
```
*Смайлы разбиты по соответствующим табам.*  
*Каталог картинок смайлов `funstream.tv/build/images/smiles/`*


## Фильтр

#### Список элементов контента
##### [`POST` `A/P` `/api/content`](http://funstream.tv/api/content)
**запрос**
```js
{
    content: <string>, // Тип контента, [stream]
    type: <string>, // Тип фильтра, [all, my]
    category: <obj> { // Категория, любой из параметров
        id: <int|null>, // Идентификатор категории
        slug: <string|null> // Короткое имя категории, top для верхней
    }
}
```
**ответ**
```js
{
    category: <obj> {
        parent: <obj|null>, // Родительская категория относительно переданной, объект из ответа /api/category
        current: <obj>, // Данные переданной категории, объект из ответа /api/category с contentAmount=true, subCategories=true с добавленным полем 'weight' для каждой категории
    },
    content: <array> [
        <obj>, // Данные стрима, объект из ответа /api/stream
        ...
    ]
}
```
*Вернёт список стримов, отсортированных по текущему рейтингу. Поле `weight <int>` у категорий(текущей и дочерних) это суммарный теукщий рейтинг стримов в этой категории. Сортировка дочерних категорий по этому параметру.*  
*Если тип `my` то вернёт список онлайн стримов из избранного пользрвателя*  
*Вернёт ошибку если переданы неверные данные каегории, контент или тип.*  
*Вернёт ошибку если передан тип `my` и пользователь не залогинен или передан неверный токен.*  


#### Топ N элементов контента
##### [`POST` `P` `/api/content/top`](http://funstream.tv/api/content/top)
**запрос**
```js
{
    content: <string>, // Тип контента, [stream]
    category: <obj> { // Категория, любой из параметров
        id: <int|null>, // Идентификатор категории
        slug: <string|null> // Короткое имя категории, top для верхней
    },
    amount: <int> // Количество элементов в ответе
}
```
**ответ**
```js
{
    content: <array> [
        <obj> // Данные стрима, объект из ответа /api/stream
        ...,
    ]
}
```
*Вернёт top-{amount} стримов, отсортированных по рейтингу.*  
*Вернёт ошибку если переданы неверные данные категории или контент.*


## Подписки

#### Подписаться
##### [`POST` `A` `/api/subscribe/add`](http://funstream.tv/api/subscribe/add)
**запрос**
```js
{
    content: <string>, // Тип контента, [stream]
    id: <int> // Идентификатор элемента контента
}
```
**ответ**
```js
[]
```
*Вернёт ошибку если передан неверный тип контента, элемент контента не существует, пользователь не залогинен или передан неверный токен.*


#### Количество активных подписок
##### [`POST` `A` `/api/subscribe/amount`](http://funstream.tv/api/subscribe/amount)
**запрос**
```js
{
    content: <string> // Тип контента, [stream]
}
```
**ответ**
```js
{
    amount: <int> // Количество активных подписок
}
```
*Вернёт количество активных(онлайн) элементов в подписках у пользователя.*  
*Вернёт ошибку если передан наверный тип контента, пользователь не залогинен или передан неверный токен.*


#### Проверить подписку
##### [`POST` `A` `/api/subscribe/check`](http://funstream.tv/api/subscribe/check)
**запрос**
```js
{
    content: <string>, // Тип контента, [stream]
    id: <int> // Идентификатор элемента контента
}
```
**ответ**
```js
{
    result: <bool> // true в случае наличия подписки
}
```
*Вернёт ошибку если передан неверный тип контента, элемент контента не существует, пользователь не залогинен или передан неверный токен.*


#### Список подписок
##### [`POST` `A` `/api/subscribe/list`](http://funstream.tv/api/subscribe/list)
**запрос**
```js
{
    content: <string> // Тип контента, [stream]
}
```
**ответ**
```js
[
    <obj>, // Данные элемента контента, объект из ответа /api/stream
    ...
]
```
*В данный момент работает неверно.*  
*Вернёт ошибку если передан наверный тип контента, пользователь не залогинен или передан неверный токен.*


#### Отписаться
##### [`POST` `A` `/api/subscribe/remove`](http://funstream.tv/api/subscribe/remove)
**запрос**
```js
{
    content: <string>, // Тип контента, [stream]
    id: <int> // Идентификатор элемента контента
}
```
**ответ**
```js
[]
```
*Вернёт ошибку если передан неверный тип контента, элемент контента не существует, пользователь не залогинен или передан неверный токен.*


#### Список подписчиков пользователя
##### [`POST` `A` `/api/subscribe/subscribers`](http://funstream.tv/api/subscribe/subscribers)
**запрос**
```js
{
    content: <string> // Тип контента, [stream]
}
```
**ответ**
```js
[
    <obj>, // Данные юзера, объект из ответа /api/user
    ...
]
```
*Вернёт список подписчиков на текущего юзера, если он является стримером(имеет запись о стриме в бд).*  
*Вернёт ошибку если передан наверный тип контента, пользователь не залогинен или передан неверный токен.*


## Игноры

#### Добавить в список игнорируемых
##### [`POST` `A` `/api/ignore/add`](http://funstream.tv/api/ignore/add)
**запрос**
```js
{
    content: <string>, // Тип контента, [stream, chat]
    item: <int> // Идентификатор элемента контента
}
```
**ответ**
```js
[]
```
*Вернёт ошибку если передан неверный тип контента, элемент контента не существует, пользователь не залогинен или передан неверный токен.*


#### Проверить на игнор
##### [`POST` `A` `/api/ignore/check`](http://funstream.tv/api/ignore/check)
**запрос**
```js
{
    content: <string>, // Тип контента, [stream, chat]
    item: <int> // Идентификатор элемента контента
}
```
**ответ**
```js
{
    ignored: <bool> // true если в игноре
}
```
*Вернёт ошибку если передан неверный тип контента, элемент контента не существует, пользователь не залогинен или передан неверный токен.*


#### Список игнорируемого
##### [`POST` `A` `/api/ignore/list`](http://funstream.tv/api/ignore/list)
**запрос**
```js
{
    content: <string>, // Тип контента, [stream, chat]
}
```
**ответ**
```js
[
    {
        content: <string>, // Тип контента, [stream, chat]
        item: <int> // Идентификатор элемента контента
    },
    ...
]
```
*Вернёт ошибку если передан наверный тип контента, пользователь не залогинен или передан неверный токен.*


#### Удалить из списка игнорируемого
##### [`POST` `A` `/api/ignore/remove`](http://funstream.tv/api/ignore/remove)
**запрос**
```js
{
    content: <string>, // Тип контента, [stream, chat]
    item: <int> // Идентификатор элемента контента
}
```
**ответ**
```js
[]
```
*Вернёт ошибку если передан неверный тип контента, элемент контента не существует, пользователь не залогинен или передан неверный токен.*


## Дополнительные вызовы

#### Пакетный запрос
##### [`POST` `P` `/api/bulk`](http://funstream.tv/api/bulk)
**запрос**
```js
{
    command: <array> [ // Массив запросов
        <array> [ // Запрос
            <string>, // Урл запроса, например /api/user
            <obj> // Параметры запроса
        ],
        ...
    ]
}
```
**ответ**
```js
[
    <array> [ // Результат соответствующего запроса
        <string>, // Урл запроса, например /api/user
        <obj>, // Параметры запроса
        <obj|array>, // Ответ на запрос
        <boolean> // Статус запроса, true на успешное выполнение
    ],
    ...
]
```
*Позволяет получить результаты нескольких запросов за один.*  
*Для каждого запроса возвращает массив с его данными, статусом выполнения и результатом. Индекс ответа соответствует индексу в массиве запросов.*  
*Если запрос дал ошибку, то в ответе на этот запрос будет объект ошибки и статус false.*


#### Получить список последних поддержавших для данного стримера за 5 минут
##### [`POST` `P` `/api/support?name=<streamer_name>`](http://funstream.tv/api/support?name=<streamer_name>)(заменить на json?)
**запрос**
```js
[]
```
**ответ**
```js
[
    {
        date: <float>, // Когда поддержал(формат Юникс)
        support: <string>, // Имя поддержавшего
        amount: <float>, // Сумма поддержки
        msg: <string> // Сообщение
    },
    ...
]
```
*Вернёт список поддержавших данного стримера за последние 5 минут.*