API Администрирования
=====================

1. [**Модерация**](#Модерация)
    - [`POST` `A` `/api/moderation/accuse` Забанить пользователя](#Забанить-пользователя)
    - [`POST` `P` `/api/moderation/check` Проверить забанен ли пользователь](#Проверить-забанен-ли-пользователь)
    - [`POST` `M` `/api/moderation/list` Получить список банов](#Получить-список-банов)
    - [`POST` `P` `/api/moderation/reasons` Получить список причин бана](#Получить-список-причин-бана)
    - [`POST` `M` `/api/moderation/undo` Отменить бан](#Отменить-бан)
2. [**Поддержка**](#Поддержка)
    - [`POST` `A` `/api/support/ask` Задать вопрос](#Задать-вопрос)
    - [`POST` `A` `/api/support/ban` Отключить возможность задавать вопросы](#Отключить-возможность-задавать-вопросы)
    - [`POST` `A` `/api/support/channels` Список последних вопросов](#Список-последних-вопросов)
    - [`POST` `S` `/api/support/list` Получить список вопросов](#Получить-список-вопросов)

## Модерация

#### Забанить пользователя
#####[`POST` `A` `/api/moderation/accuse`](http://funstream.tv/api/moderation/accuse)
**запрос**
```js
{
    userId: <int>, // Идентификатор пользователя, которого нужно попытаться забанить
    reasonId: <int>, // Идентификатор причины бана
    data: <object|null> // Дополнительная информация
}
```
**ответ**
```js
[]
```
*Вернёт ошибку если пользователь или причина не существуют, у юзера нет прав для указанной причины, пользователь не залогинен или передан неверный токен.*


####  Проверить забанен ли пользователь
#####[`POST` `P` `/api/moderation/check`](http://funstream.tv/api/moderation/check)
**запрос**
```js
{
    userId: <int> // Идентификатор пользователя, которого нужно проверить
}
```
**ответ**
```js
{
    id: <int>, // Идентификатор бана
    banned: <bool>, // true если забанен, false если не забанен или пользователь не существует
    expire: <int>, // Время истечения бана или 0 если не забанен, временная метка, 0 для незабаненных
    reason: <int> // Идентификатор причины бана, 0 для незабаненных
}
```
*Если банов несколько, то вернет тот, который заканчивается позднее всего.*  
*Вернёт ошибку если передан пустой или несуществующий userId.*


#### Получить список банов
#####[`POST` `M` `/api/moderation/list`](http://funstream.tv/api/moderation/list)
**запрос**
```js
{
    from: <int|null>, // От временной метки
    to: <int|null>, // До временной метки
    reason: <int|null> // Фильтр по указанной причине
}
```
**ответ**
```js
[
    {
        id: <int>, // Идентификатор бана
        start: <int>, // Время начала бана, временная метка
        end: <int>, // Время истечения бана, временная метка
        reason: <obj> // Объект из ответа /api/moderation/reasons
    },
    ...
]
```
*Вернёт ошибку если пользователь не залогинен, передан неверный токен или пользователь не имеет роли moderator.*


#### Получить список причин бана
#####[`POST` `P` `/api/moderation/reasons`](http://funstream.tv/api/moderation/reasons)
**запрос**
```js
{
    content: <string> // Тип контента, [chat]
}
```
**ответ**
```js
[
    {
        id: <int>, // Идентификатор причины
        name: <string>, // Имя причины
        content: <string> // Тип контента
    },
    ...
]
```
*Вернёт ошибку если передан неверный тип контента.*


#### Отменить бан
#####[`POST` `M` `/api/moderation/undo`](http://funstream.tv/api/moderation/undo)
**запрос**
```js
{
    ban: <int> // Идентификатор бана
}
```
**ответ**
```js
[]
```
*Отменяет выбранный бан, при этом выдавая бан всем пользователям, которые его ставили.*  
*Вернёт ошибку если бан с указанным идентификатором не существует, пользователь не залогинен, передан неверный токен или пользователь не имеет роли moderator.*


## Поддержка

Общение ведётся в отдельном канале чата `support/<id>`, где `<id>` это идентификатор вопроса. Реальые идентификаторы и имена пользователей(спрашивающего и отвечающих) скрыты и не передаются в запросах по саппорт каналам.  
Активными вопросами считаются те, у которых в соответствующем канале чата последнее сообщение от спрашивающего.


#### Задать вопрос
#####[`POST` `A` `/api/support/ask`](http://funstream.tv/api/support/ask)
**запрос**
```js
{
    category: <int>, // Идентификатор категории
    question: <string> // Текст вопроса
}
```
**ответ**
```js
{
    id: <int>, // Идентификатор вопроса
    time: <string>, // Дата и время вопроса, временная метка
    category: <obj> // Данные категории, объект из ответа /api/category
    question: <string>, // Текст вопроса
    active: <bool> // Состояние вопроса, true для только созданного
}
```
*Вернёт ошибку если передан неверный идентификатор категории, текст вопроса пустой, у пользователя есть уже 3 неотвеченных вопроса(без хотя бы одного ответа поддержки), пользователь лишён права задавать вопросы(роль canUseSupport === false), не залогинен или передан неверный токен.*


#### Отключить возможность задавать вопросы
#####[`POST` `A` `/api/support/ban`](http://funstream.tv/api/support/ban)
**запрос**
```js
{
    id: <int> // Идентификатор вопроса
}
```
**ответ**
```js
{}
```
*Снимает с юзера, задавшего вопрос, роль canUseSupport, после чего тот не может задавать вопросы до разбана.*  
*Вернёт ошибку если передан неверный идентификатор вопроса, пользователь не залогинен, передан неверный токен или пользователь не имеет роли support.*


#### Список последних вопросов
#####[`POST` `A` `/api/support/channels`](http://funstream.tv/api/support/channels)
**запрос**
```js
{}
```
**ответ**
```js
[
    <string>, // Идентификатор чат канала вопроса
    ...
]
```
*Вернёт список чат каналов последних вопросов пользователя(10 штук), отсортированных по активности(без ответа поддержки первыми) и времени создания(более поздние первыми).*  
*Вернёт ошибку если пользователь не залогинен или передан неверный токен.*


#### Получить список вопросов
#####[`POST` `S` `/api/support/list`](http://funstream.tv/api/support/list)
**запрос**
```js
{
    category: <int|null>, // Идентификатор категории
    from: <int|null>, // Дата начала поиска, временная метка
    onlyActive: <bool|null> // Вернуть только активные вопросы, true по умолчанию
}
```
**ответ**
```
[
    <object>, // Данные вопроса, объект из ответа /api/support/ask
    ...
]
```
*Вернёт ошибку если передан не верный идентификатор категории, пользователь не залогинен, передан неверный токен или пользователь не имеет роли support.*
