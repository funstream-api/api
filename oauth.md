Работа с [OAuth](http://oauth.net/)
==================

Термины
------------------
- **сервер** - веб-сервер [Funstream.tv](http://funstream.tv/)
- **приложение** - веб-сервер приложения, либо приложение в телефоне
- **пользователь** - зарегистрированный пользователь на [Funstream.tv](http://funstream.tv/)
- **браузер** - браузер пользователя


Последовательность действий
------------------
1. Приложение запрашивает код используя [`/api/oauth/request`](#Запросить-код)
2. Приложение передает код в браузер, предлагая пользователю перейти по ссылке ```http://funstream.tv/oauth/<code>```
3. Пользователь переходит по ссылке (открывается в новом окне, `target="_blank"`)
4. Пользователь подтверждает код для приложения и закрывает окно
5. Пользователь жмет "продолжить" в приложении
6. Приложение получает токен используя [`/api/oauth/exchange`](#Получить-токен-по-коду)
7. Приложение вызывает api Funstream.tv, используя полученый токен


OAuth API
------------------
- [`POST` `P` `/api/oauth/check` Проверка статуса кода](#Проверка-статуса-кода)
- [`POST` `P` `/api/oauth/exchange` Получить токен по коду](#Получить-токен-по-коду)
- [`POST` `A` `/api/oauth/grant` Предоставить доступ по коду](#Предоставить-доступ-по-коду)
- [`POST` `P` `/api/oauth/request` Запросить код](#Запросить-код)


#### Проверка статуса кода
#####[`POST` `P` `/api/oauth/check`](http://funstream.tv/api/oauth/check)
**запрос**
```js
{
    code: <string> // Код доступа OAuth
}
```
**ответ**
```js
{
    id: <int>, // Идентификатор кода доступа
    text: <string> // Текст переданный с кодом доступа
}
```
*Вернёт ошибку если переданный код не существует или уже подтверждён.*


#### Получить токен по коду
#####[`POST` `P` `/api/oauth/exchange`](http://funstream.tv/api/oauth/exchange)
**запрос**
```js
{
    code: <string> // Код доступа OAuth
}
```
**ответ**
```js
{
    token: <string>, // Токен доступа API
    user: <obj> // Объект из ответа /api/user/current
}
```
*Вернёт ошибку если переданный код не существует или не подтвержден пользователем.*


#### Предоставить доступ по коду
#####[`POST` `A` `/api/oauth/grant`](http://funstream.tv/api/oauth/grant)
**запрос**
```js
{
    code: <string> // Код доступа OAuth
}
```
**ответ**
```js
[]
```
*Вернёт ошибку если переданный код не существует, уже подтвержден, пользователь не залогинен или передан неверный токен.*


#### Запросить код
#####[`POST` `P` `/api/oauth/request`](http://funstream.tv/api/oauth/request)
**запрос**
```js
{
    text: <string> // Имя приложения или любой другой текст, который будет показан пользователю на странице подтверждения доступа
}
```
**ответ**
```js
{
    code: <string> // Код доступа OAuth
}
```
*Вернёт ошибку если передан пустой текст.*
